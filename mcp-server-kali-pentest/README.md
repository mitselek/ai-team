# MCP Server: Kali Linux Penetration Testing Tools

Educational security testing MCP server providing network scanning and vulnerability assessment tools through a Kali Linux Docker container.

**WARNING**: For educational and authorized testing only. Unauthorized network scanning and penetration testing is illegal. Only scan systems you own or have explicit written permission to test.

## Features

- **Network Scanning**: Port scanning and service detection with nmap
- **Web Vulnerability Scanning**: Web server security assessment with Nikto
- **SQL Injection Testing**: Automated SQLi detection with SQLMap
- **WordPress Security**: WordPress vulnerability scanning with WPScan
- **Directory Enumeration**: Hidden resource discovery with dirb
- **Exploit Research**: Exploit database search with searchsploit

## Security Features

- Runs in isolated Docker container with minimal privileges
- Non-root execution (kali user)
- Input sanitization to prevent command injection
- Network access controls (localhost/internal only by default)
- Resource limits (CPU, memory)
- Comprehensive audit logging
- Read-only filesystem with dropped capabilities

## Installation

### Prerequisites

- Python 3.10+
- Docker installed and running
- Claude Desktop or Claude Code

### Setup

```bash
# Clone repository
git clone https://github.com/yourusername/mcp-kali-pentest
cd mcp-kali-pentest

# Install dependencies
pip install -r requirements.txt

# Pull Kali Linux Docker image
docker pull kalilinux/kali-rolling

# Install security tools in container
docker run -it kalilinux/kali-rolling bash
apt update && apt install -y nmap nikto sqlmap wpscan dirb exploitdb
exit

# Configure environment
cp .env.example .env
# Edit .env to set allowed networks
```

## Configuration

Create `.env` file:

```bash
# Comma-separated list of allowed networks/IPs
ALLOWED_NETWORKS=127.0.0.1,localhost,192.168.1.0/24

# Logging
LOG_LEVEL=INFO

# Timeouts
MAX_TIMEOUT=300

# WPScan API token (optional, for vulnerability data)
# Get from: https://wpscan.com/api
WPSCAN_API_TOKEN=your_token_here
```

## Usage

### With Claude Code

```bash
# Add MCP server
claude mcp add --transport stdio kali-pentest -- python -m src.server

# List configured servers
claude mcp list

# Use tools in Claude Code
# "Use nmap_scan to scan localhost for open ports"
# "Search searchsploit for apache exploits"
```

### With Claude Desktop

Add to `~/.config/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "kali-pentest": {
      "command": "python",
      "args": ["-m", "src.server"],
      "cwd": "/path/to/mcp-kali-pentest",
      "env": {
        "ALLOWED_NETWORKS": "127.0.0.1,localhost"
      }
    }
  }
}
```

## Available Tools

### nmap_scan

Network port scanner for discovering hosts and services.

**Parameters**:

- `target` (required): IP address, hostname, or CIDR range
- `scan_type` (optional): quick, full, stealth, udp, service (default: quick)
- `additional_args` (optional): Extra nmap arguments

**Example**:

```text
Use nmap_scan to perform a quick scan of localhost
```

### nikto_scan

Web server vulnerability scanner.

**Parameters**:

- `target` (required): Target URL
- `ssl` (optional): Force SSL mode
- `port` (optional): Target port

**Example**:

```text
Use nikto_scan to check http://localhost:8080 for vulnerabilities
```

### sqlmap_test

SQL injection vulnerability scanner.

**Parameters**:

- `url` (required): Target URL with parameters
- `method` (optional): GET or POST (default: GET)
- `data` (optional): POST data
- `level` (optional): Test level 1-5 (default: 1)

**Example**:

```text
Use sqlmap_test to check http://localhost/page?id=1 for SQL injection
```

### wpscan_test

WordPress security scanner.

**Parameters**:

- `url` (required): WordPress site URL
- `enumerate` (optional): vp (vulnerable plugins), ap (all plugins), tt (themes), u (users)
- `api_token` (optional): WPScan API token

**Example**:

```text
Use wpscan_test to scan http://localhost/wordpress for vulnerable plugins
```

### dirb_scan

Web content scanner (directory/file brute forcing).

**Parameters**:

- `url` (required): Target URL
- `wordlist` (optional): common, small, big (default: common)
- `extensions` (optional): File extensions (e.g., "php,html,txt")

**Example**:

```text
Use dirb_scan to discover hidden directories on http://localhost
```

### searchsploit_query

Exploit database search.

**Parameters**:

- `query` (required): Search query (software name, version, CVE)
- `exact` (optional): Exact match only
- `json_output` (optional): JSON format (default: true)

**Example**:

```text
Use searchsploit_query to find exploits for "apache 2.4.49"
```

## Development

```bash
# Install development dependencies
pip install -r requirements-dev.txt

# Run tests
pytest tests/ -v

# Run tests with coverage
pytest tests/ --cov=src --cov-report=html

# Lint code
ruff check src/ tests/

# Format code
black src/ tests/

# Type checking
mypy src/ tests/
```

## Testing

```bash
# Run all tests
pytest tests/ -v

# Run specific test file
pytest tests/test_tools.py -v

# Run with coverage
pytest tests/ --cov=src --cov-report=term-missing
```

## Security Considerations

### Network Isolation

By default, the server only allows scanning localhost and networks specified in `ALLOWED_NETWORKS`. This prevents accidental or malicious scanning of external networks.

### Input Validation

All user inputs are sanitized to prevent command injection:

- Regex validation on target addresses
- Blocking of shell metacharacters
- Whitelisting of allowed parameters

### Container Security

Docker containers run with:

- Non-root user (kali)
- Dropped capabilities (ALL removed, only NET_RAW/NET_ADMIN added)
- Read-only filesystem
- Memory and CPU limits
- no-new-privileges security option

### Audit Logging

All tool executions are logged with:

- Timestamp
- Tool name
- Target
- User context
- Results

### Legal Compliance

This tool is for **educational purposes only**. Users are responsible for:

- Obtaining written permission before scanning any systems
- Complying with local laws and regulations
- Using tools ethically and responsibly
- Understanding the legal implications of penetration testing

## Troubleshooting

### Docker image not found

```bash
docker pull kalilinux/kali-rolling
```

### Permission denied errors

Ensure Docker daemon is running and user is in docker group:

```bash
sudo systemctl start docker
sudo usermod -aG docker $USER
# Log out and back in
```

### Tools not found in container

Install tools in the Kali container:

```bash
docker run -it kalilinux/kali-rolling bash
apt update
apt install -y nmap nikto sqlmap wpscan dirb exploitdb
exit
```

### Timeout errors

Increase MAX_TIMEOUT in `.env`:

```bash
MAX_TIMEOUT=600  # 10 minutes
```

## Roadmap

- [ ] Add Metasploit integration
- [ ] Implement SSL/TLS testing (testssl.sh)
- [ ] Add Burp Suite automation
- [ ] Support custom wordlists
- [ ] Add report generation
- [ ] Implement rate limiting
- [ ] Add webhook notifications
- [ ] Support multiple container instances

## Contributing

Contributions welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure all tests pass
5. Submit a pull request

## License

MIT License - see LICENSE file for details

## Disclaimer

This tool is provided for educational purposes only. The authors are not responsible for any misuse or damage caused by this program. Users must ensure they have proper authorization before conducting any security testing.

## Resources

- [Model Context Protocol](https://modelcontextprotocol.io/)
- [Kali Linux](https://www.kali.org/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [Nmap Documentation](https://nmap.org/book/man.html)
- [SQLMap Documentation](https://github.com/sqlmapproject/sqlmap/wiki)

## Support

For issues and questions:

- GitHub Issues: <https://github.com/yourusername/mcp-kali-pentest/issues>
- Security concerns: Email <security@example.com>
